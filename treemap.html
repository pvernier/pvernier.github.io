<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="WHO, OMS">
    <title>EWARN - WHO - IRAQ</title>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71651507-1', 'auto');
      ga('send', 'pageview');

    </script>
    <link href="code/src/bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet"> 
    <link rel="stylesheet" href="code/css/style.css"/>
    <script src="code/src/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="http://mbostock.github.io/d3/talk/20111018/d3/d3.js"></script>
    <script type="text/javascript" src="http://mbostock.github.io/d3/talk/20111018/d3/d3.layout.js"></script>
 <style type="text/css">

.chart {
  display: block;
  margin: auto;
}

text {
  font-size: 11px;
}

rect {
  fill: none;
}

div#buttons_dis {
	width: 80%;
	margin: 0 auto;
	margin-bottom: 10px;
}

div#buttons_dis div {
	display: inline-block;
}

div#buttons_dis span {
	padding: 8px 8px;
	font-size: 0px;
	vertical-align: middle;
	margin: 0 5px 0 10px;
	border-radius: 50%;
}

div#resp_dis span {
	background-color: #1f77b4;
}

div#water_dis span {
	background-color: #ff7f0e;
}

div#vaccine_dis span {
	background-color: #2ca02c;
}

div#comm_dis span {
	background-color: #d62728;
}

div#other_dis span {
	background-color: #9467bd;
}

ul.list-group {
  display: none;
  width: 50%;
  margin: 0 auto;
  margin-top: 25px;
  margin-bottom: 25px;
}
li#disease_name {
  font-weight: bold;
}

</style>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html"><img src="code/img/logos/MOH-F.jpg" width="53px" height="51px">&nbsp;WHO - IRAQ - EWARN</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="case_definition.html"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>  Case Definition</a></li>
            <li><a href="resources.html">Other Resources</a></li>
            <li><a href="partners.html">Partners</a></li>
          </ul>
          <img id="who_logo" src="code/img/logos/who.svg" width="150px" height="50px">
        </div>
      </div>
    </nav>
    </br>
    </br>
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
        	<h1>Proportion of the different diseases</h1>
          <div class="alert alert-info" role="alert"><b>Hint</b>: Pass your mouse over a block to display the name of the corresponding disease. By clicking on a block you can also zoom in to its category.</div>
          <ul class="list-group">
            <li class="list-group-item" id="disease_name"></li>
            <li class="list-group-item" id="nb_cons"></li>
            <li class="list-group-item" id="perc_cat"></li>
            <li class="list-group-item" id="perc_tot"></li>
          </ul>
        </div>
        <div class="col-md-2"></div>
    </div>
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
		    <div id="buttons_dis">
			    <div id="resp_dis"><span></span>Respiratory Diseases</div>
			    <div id="water_dis"><span></span>Water Borne Diseases</div>
			    <div id="vaccine_dis"><span></span>Vaccine Preventable Diseases</div>
			    <div id="comm_dis"><span></span>Other Communicable Diseases</div>
			    <div id="other_dis"><span></span>Others</div>
		    </div>
        </div>
        <div class="col-md-2"></div>
    </div>
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
        	<div id="body"></div>
        </div>
        <div class="col-md-2"></div>
    </div>

    <script type="text/javascript">

var w = 1280 - 80,
    h = 800 - 180,
    x = d3.scale.linear().range([0, w]),
    y = d3.scale.linear().range([0, h]),
    color = d3.scale.category10(),
    root,
    node;

var treemap = d3.layout.treemap()
    .round(false)
    .size([w, h])
    .sticky(true)
    .value(function(d) { return d.size; });

var svg = d3.select("#body").append("div")
    .attr("class", "chart")
    .style("width", w + "px")
    .style("height", h + "px")
  .append("svg:svg")
    .attr("width", w)
    .attr("height", h)
  .append("svg:g")
    .attr("transform", "translate(.5,.5)");

d3.json("flare_2.json", function(data) {
  node = root = data;

  var nodes = treemap.nodes(root)
      .filter(function(d) { return !d.children; });

  var cell = svg.selectAll("g")
      .data(nodes)
    .enter().append("svg:g")
      .attr("class", "cell")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .on("click", function(d) { return zoom(node == d.parent ? root : d.parent); })
      .on("mouseover", function(d) {
        $("div.alert-info").hide();
        $("ul.list-group").show();
        $("#disease_name").css("background-color", color(d.parent.name));
        d3.select("ul.list-group #disease_name").text(d.name);
        d3.select("ul.list-group #nb_cons").html('<span class="badge">' + d.size.toLocaleString() + '</span>Number of consultations');

        // For 'Others' it makes no sense to display the % among category
        if (d.name ==='Others') {
          $("ul.list-group #perc_cat").hide(); 
        }
        else {
          $("ul.list-group #perc_cat").show(); 
          d3.select("ul.list-group #perc_cat").html('<span class="badge">' + Math.round(d.size/d.parent.total*1000)/10 + '%' + '</span>Percentage among ' + d.parent.name);
        }

        d3.select("ul.list-group #perc_tot").html('<span class="badge">' + Math.round(d.size/data.total*1000)/10 + '%' + '</span>Percentage among all consultations');
        $("span.badge").css("background-color", color(d.parent.name));

      });

  cell.append("svg:rect")
      .attr("width", function(d) { return d.dx - 1; })
      .attr("height", function(d) { return d.dy - 1; })
      .style("fill", function(d) { return color(d.parent.name); });

  cell.append("svg:text")
      .attr("x", function(d) { return d.dx / 2; })
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .text(function(d) { return d.name; })
      .style("opacity", function(d) { d.w = this.getComputedTextLength(); return d.dx > d.w ? 1 : 0; });

  d3.select(window).on("click", function() { zoom(root); });


zoom_cat_dis("div#resp_dis", data.children[1]);
zoom_cat_dis("div#water_dis", data.children[2]);
zoom_cat_dis("div#vaccine_dis", data.children[4]);
zoom_cat_dis("div#comm_dis", data.children[3]);
zoom_cat_dis("div#other_dis", data.children[0]);                                             

});

function size(d) {
  return d.size;
}

function zoom_cat_dis(html_elem, id) {
  	d3.select(html_elem).on("click", function() { 
	    if (node.name == "flare") {
	      zoom(id);
	    }
	    else {
	      zoom(id.parent);
	    }
   });
  }

function zoom(d) {
  var kx = w / d.dx, ky = h / d.dy;
  x.domain([d.x, d.x + d.dx]);
  y.domain([d.y, d.y + d.dy]);

  var t = svg.selectAll("g.cell").transition()
      .duration(d3.event.altKey ? 7500 : 750)
      .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });

  t.select("rect")
      .attr("width", function(d) { return kx * d.dx - 1; })
      .attr("height", function(d) { return ky * d.dy - 1; });

  t.select("text")
      .attr("x", function(d) { return kx * d.dx / 2; })
      .attr("y", function(d) { return ky * d.dy / 2; })
      .style("opacity", function(d) { return kx * d.dx > d.w ? 1 : 0; });

  node = d;
  d3.event.stopPropagation();
}

</script>
    
     <script src="code/src/bootstrap-3.3.4-dist/js/bootstrap.min.js"></script> 
    
  </body>
</html>